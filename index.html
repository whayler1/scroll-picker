<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	
		<title>test</title>
		
		<style type="text/css">
			/*
			 *reset
			 */
			html, body, div, span, applet, object, iframe,
			h1, h2, h3, h4, h5, h6, p, blockquote, pre,
			a, abbr, acronym, address, big, cite, code,
			del, dfn, em, img, ins, kbd, q, s, samp,
			small, strike, strong, sub, sup, tt, var,
			b, u, i, center,
			dl, dt, dd, ol, ul, li,
			fieldset, form, label, legend,
			table, caption, tbody, tfoot, thead, tr, th, td,
			article, aside, canvas, details, embed, 
			figure, figcaption, footer, header, hgroup, 
			menu, nav, output, ruby, section, summary,
			time, mark, audio, video {
				margin: 0;
				padding: 0;
				border: 0;
				font-size: 100%;
				font: inherit;
				vertical-align: baseline;
			}
			/* HTML5 display-role reset for older browsers */
			article, aside, details, figcaption, figure, 
			footer, header, hgroup, menu, nav, section {
				display: block;
			}
			body {
				line-height: 1;
			}
			ol, ul {
				list-style: none;
			}
			blockquote, q {
				quotes: none;
			}
			blockquote:before, blockquote:after,
			q:before, q:after {
				content: '';
				content: none;
			}
			table {
				border-collapse: collapse;
				border-spacing: 0;
			}
			
			/*
			 * thumpicker styles
			 */
			
			.thumbpicker { position: relative; width: 790px; height: 110px; background: #888; margin: 0 auto; overflow: hidden; }
			.thumbpicker > ul { position: absolute; top: 0; left: 0; white-space: nowrap; }
			.thumbpicker > ul > li { width: 150px; height: 110px; background: #9d9d9d; margin: 0 0 0 10px; vertical-align: top; display: inline-block; *display:inline; *zoom: 1; }
			.thumbpicker > ul > li:first-child { margin-left: 0; }
			.thumbpicker > ul > li > a { display: block; font-size: 30px; line-height: 110px; color: #dfdfdf; text-align: center; text-decoration: none; }
			.thumbpicker > ul > li.selected,
			.thumbpicker > ul > li.hover { width: 140px; height: 100px; border: 5px solid #dfdfdf; background: #ccc; }
			.thumbpicker > ul > li.selected > a,
			.thumbpicker > ul > li.hover > a { line-height: 100px; color: #fff; }
			
			#display { font-size: 15px; line-height: 15px; margin: 10px; text-align: center; }
			#display > ul > li { display: block; }
		</style>
		
	</head>
	<body>
		<div id="display">
			<ul>
				<li id="is-ie">IE? <span></span></li>
				<li id="is-touch">touch device? <span></span></li>
				<li id="cont-wid">container width: <span></span></li>
				<li id="ul-wid">ul width: <span></span></li>
				<li id="clientx">client x: <span>nan</span></li>
				<li id="bodyleft">body left: <span>nan</span></li>
				<li id="pct">percent: <span></span></li>
				<li id="ul_targ_pos">ul target position: <span></span></li>
				<li id="curpos">ul current pos: <span></span></li>
				<li id="diff">difference: <span></span></li>
				<li id="ease">ease: <span></span></li>
				<li id="step">step: <span></span></li>
			</ul>
		</div>
		<div class="thumbpicker" id="tp">
			<ul>
				<li><a href="#one">1</a></li><li><a href="#one">2</a></li><li><a href="#one">3</a></li><li><a href="#one">4</a></li><li><a href="#one">5</a></li><li><a href="#one">6</a></li><li><a href="#one">7</a></li><li><a href="#one">8</a></li>
			</ul>
		</div>
		
		<script type="text/javascript">
			Math.easeInQuad = function (t, b, c, d) {
				t /= d;
				return c*t*t + b;
			};
			Math.easeOutQuad = function (t, b, c, d) {
				t /= d;
				return -c * t*(t-2) + b;
			};
			
			var FS = {};
			
			FS.IE = document.all?true:false;
			
			FS.thumbpicker = function(args) {
				var container = args.container,
					scrollpad = args.scrollpad || 0,
					isslideshow = args.isslideshow || false,
					istouchdevice = (typeof(window.ontouchstart) != 'undefined') ? true : false,
					ul = container.getElementsByTagName('ul')[0],
					lis = ul.getElementsByTagName('li'),
					selected_li = args['selected-li'] || lis[0],
					anchors = [],
					thumb_width = ul.getElementsByTagName('li')[0].offsetWidth,
					container_width = container.offsetWidth,
					scrollable_width = container_width - (scrollpad*2),
					ul_width = ul.offsetWidth,
					ul_scrollable_width = ul_width - container_width,
					tick_multiplyer = FS.IE? 30 : 20,
					requestAnimFrame =
						window.requestAnimationFrame ||
						window.webkitRequestAnimationFrame ||
						window.mozRequestAnimationFrame ||
						window.oRequestAnimationFrame ||
						window.msRequestAnimationFrame ||
						function(fn) {
							//Just 30 fps, because that's enough for those legacy browsers
							window.setTimeout(fn, 1000 / 30);
						},
					clientx = 0,
					mouseout_to, /* timeout to stop mouseout from over-firing */
					slideshow_to, /* timeout for slideshow */
					istouchdown = false,
					istickon = false,
					SELECTED = 'selected',
					HOVER = 'hover';
				
				selected_li.className = SELECTED;
				
				function onLiHit(e) {
					//console.log('on li hit');
					//console.log(this);
					if(this!==window) {
						//console.log('hit had event');
						var self=this;
						selected_li = self;
					}
					for(var i=0; i<lis.length; i++) {
						if(lis[i]!==self) {
							lis[i].className = '';
						}
					}
					selected_li.className = SELECTED;
				}
				function onLiOver(e) {
					var self=this;
					if(self.className!==SELECTED) {
						self.className = HOVER;
					}
					return false;
				}
				function onLiOut(e) {
					var self=this;
					if(self.className!==SELECTED) {
						self.className = '';
					}
					return false;
				}
				
				for(var i=0; i<lis.length; i++) {
					var lisi = lis[i];
					anchors.push(lisi.getElementsByTagName('a')[0]);
					if(!istouchdevice) {
						lisi.onmouseover = onLiOver;
						lisi.onmouseout = onLiOut;
						lisi.onmouseup = onLiHit;
					}else {
						lisi.ontouchend = onLiHit;
					}
				}
				for(i=0; i<anchors.length; i++) {
					var anc = anchors[i];
					if(!istouchdevice) {
						anc.onmouseup = function(e) {
							//alert('hit');
							return false;
						}
					}else {
						anc.ontouchstart = function(e) {
							e.preventDefault();
							return false;
						}
					}
				}
				
				document.getElementById('is-ie').getElementsByTagName('span')[0].innerHTML = FS.IE;
				document.getElementById('is-touch').getElementsByTagName('span')[0].innerHTML = istouchdevice;
				document.getElementById('cont-wid').getElementsByTagName('span')[0].innerHTML = container_width;
				document.getElementById('ul-wid').getElementsByTagName('span')[0].innerHTML = ul_width;
				
				var client_x = document.getElementById('clientx').getElementsByTagName('span')[0],
					bodyleft = document.getElementById('bodyleft').getElementsByTagName('span')[0],
					disp_pct = document.getElementById('pct').getElementsByTagName('span')[0],
					disp_ultargpos = document.getElementById('ul_targ_pos').getElementsByTagName('span')[0],
					disp_diff = document.getElementById('diff').getElementsByTagName('span')[0],
					disp_ease = document.getElementById('ease').getElementsByTagName('span')[0],
					disp_curpos = document.getElementById('curpos').getElementsByTagName('span')[0],
					disp_step = document.getElementById('step').getElementsByTagName('span')[0];
				
				function onContainerTouchStart(e) {
					
				}
				
				var setMouseX = function(e) {
					clearTimeout(mouseout_to);
					clearTimeout(slideshow_to);
					
					var parentoffset = container.offsetLeft,
						tempx;
					
					if (FS.IE) { // grab the x-y pos.s if browser is IE
					    tempx = event.clientX /*+ document.body.scrollLeft  */- parentoffset - scrollpad;
					    
					    bodyleft.innerHTML = document.body.scrollLeft;
					} else {  // grab the x-y pos.s if browser is non-retarded
					    tempx = e.pageX - parentoffset - scrollpad;
					}  
					  
					if (tempx < 0){tempx = 0}
					if (tempx > scrollable_width) {tempx = scrollable_width}
					clientx = tempx;
					client_x.innerHTML = clientx;
					if(!istickon) { tick(); }
				}
				
				
				function onScrubIdle(e) {
					//alert('BOOM');
					clearTimeout(mouseout_to);
					mouseout_to = window.setTimeout(function() {
						
						var li_left= selected_li.offsetLeft;
						
						if(isslideshow) { slideshow(); }
						
						/*if(li_left<container_width) {
							clientx = 0;
						}else */if(li_left>=(ul_scrollable_width)) {
							//console.log(li_left+', '+ul_scrollable_width+', '+scrollable_width);
							clientx = scrollable_width;
						}else {
							var pct = li_left/ul_scrollable_width;
							//console.log(li_left+', '+ul_scrollable_width+', '+pct);
							clientx = scrollable_width*pct;
						}
						if(!istickon) { tick(); }
						
					}, 50);
				}
				
				function slideshow() {
					clearTimeout(slideshow_to);
					slideshow_to = window.setTimeout(function() {
						/*
						 * Should elimate first for loop here and save selected_li as an int instead of an element
						 */
						var curnum,
							lislength = lis.length;
						for(var i=0; i<lislength; i++) {
							if(lis[i].className===SELECTED) { curnum=i; break; }
						}
						if(curnum+1<lislength) {
							curnum++;
						}else { curnum=0; }
						selected_li=lis[curnum];
						onLiHit();
						onScrubIdle();
						slideshow();
						//console.log('slideshow: '+curnum);
					}, 4000);
				}
				
				var tick = function() {
					istickon=true;
					requestAnimFrame(function() {
						var pct = clientx/scrollable_width,
							targetpos = Math.round(ul_scrollable_width*pct),
							currentpos = -(ul.style.left.substr(0, ul.style.left.length-2)) || 0,
							diff = targetpos - currentpos;
						
						disp_pct.innerHTML = pct;
						disp_ultargpos.innerHTML = Math.round(ul_scrollable_width*pct);
						
						disp_diff.innerHTML = diff;
						disp_curpos.innerHTML = currentpos;
						
						if(diff!==0) {
							var easedStep = Math.easeOutQuad(diff, 0, 1, ul_scrollable_width)*tick_multiplyer,
								math,
								newpos;
							//console.log(easedStep);
							disp_ease.innerHTML = easedStep;
							
							if(currentpos>targetpos) {
								math = Math.floor;
								//newpos = Math.floor(currentpos+easedStep);
								//newpos = targetpos+easedStep;
								//newpos = Math.floor(targetpos+easedStep);
							}else {
								math = Math.ceil;
								//newpos = Math.ceil(currentpos+easedStep);
								//newpos = targetpos-easedStep;
								//newpos = Math.ceil(targetpos-easedStep);
							}
							newpos = math(currentpos+easedStep);
							disp_step.innerHTML = -newpos+'px';
							ul.style.left = -newpos+'px';
							
							tick();
						}else {
							istickon=false;
						}
					});
				}
				if(!istouchdevice) {
					container.onmousemove = setMouseX;
					container.onmouseout = onScrubIdle;
					container.onmouseover = function(e) {
						clearTimeout(mouseout_to);
						clearTimeout(slideshow_to);
					}
				}else {
					/*function onContTouch(e) {
						
						e.preventDefault();
						var orig = e.originalEvent;
						var x = orig.changedTouches[0].pageX; 
						disp_mx.innerHTML = x;
					}*/
					
					//container.addEventListener("touchstart", onContTouch, false);
					//container.addEventListener("touchmove", onContTouch, false);
					container.ontouchstart = container.ontouchmove = function(e) {
						//var orig = e.originalEvent;
						//disp_mx.innerHTML = orig;
						clearTimeout(mouseout_to);
						clearTimeout(slideshow_to);
						setMouseX(e);
					}
					container.ontouchend = container.ontouchleave = onScrubIdle;
				}
				if(isslideshow) { slideshow(); }
			}
			
			/*
			 * init
			 */
			
			FS.thumbpicker({
				container: document.getElementById('tp'),
				scrollpad: 90,
				isslideshow: true
				});
			/*
			for(var i=0; i<30; i++) {
				
				console.log(Math.easeOutQuad(i,0,1,29)*4);
			}*/
		</script>
	
	</body>
</html>